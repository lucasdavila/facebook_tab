!function(){var a=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};Chute.Data={},Chute.Data.Collection={skeleton:{live:!1,url:function(){return!1},parse:function(a){return a.data},initialize:function(a,b){b||(b={}),this.options=b,b.live&&(this.live=b.live),this.live&&this._poll()},_poll:function(){setTimeout(_.bind(function(){this.display.itemView.prototype.append=!this.display.itemView.prototype.append,this.fetch({remove:!1,merge:!0,success:_.bind(function(){this.display.itemView.prototype.append=!this.display.itemView.prototype.append,this._poll()},this)})},this),"number"==typeof this.live?this.live:3e4)},options:{page:1,per_page:30},option:function(a,b){return"perPage"==a&&(a="per_page"),a&&!b?this.options[a]:(this.options[a]=b,b)},rawData:function(){var a=[];return _.each(this.models,function(b){b=b.attributes,a.push(b)}),a},prevPage:function(a){this.page(this.options.page-1,a)},nextPage:function(a){this.page(this.options.page+1,a)},perPage:function(a){return a?(this.options.per_page=a,void 0):this.options.per_page},page:function(a,b){if(!a)return this.options.page;if(a!=this.options.page){this.options.page=a,b||(b={});var c=b.success;b.success=_.bind(function(){this.trigger("page",a),c&&c.apply(this,arguments)},this),this.fetch(b)}},fetch:function(b){b=b?_.clone(b):{},void 0===b.parse&&(b.parse=!0);var c=this,d=b.success;return b.success=function(a){var e=b.reset?"reset":"set",f=a.data;async.forEachSeries(c.filters||[],function(a,b){new a(f,function(a){f=a,b()})},function(){a.data=f,c[e](a,b),d&&d(c,a,b),c.trigger("sync",c,a,b),c.trigger("load",c,a,b)})},a(this,b),this.trigger("before:load",c),this.sync("read",this,b)}},extend:function(a,b){return Backbone.Collection.extend(_.extend({},this.skeleton,a),b)}},Chute.Data.Model={skeleton:{initialize:function(a,b){this.options=b||{}},parse:function(a){return a.data||a},rawData:function(){return this.attributes},fetch:function(b){b=b?_.clone(b):{},void 0===b.parse&&(b.parse=!0);var c=this,d=b.success;return b.success=function(a){return c.set(c.parse(a,b),b)?(d&&d(c,a,b),c.trigger("sync",c,a,b),c.trigger("load",c,a,b),void 0):!1},a(this,b),this.trigger("before:load",c),this.sync("read",this,b)}},extend:function(a,b){return Backbone.Model.extend(_.extend({},this.skeleton,a),b)}},Chute.Data.Filter={extend:function(a){var b=function(){function b(a,b){this.data=a,this.doneCallback=b,this.initialize.call(this)}return b.prototype.done=function(a){this.doneCallback(a)},_.forOwn(a,function(a,c){b.prototype[c]=a}),b}();return b}},Chute.Data.Filter.BrokenImages=Chute.Data.Filter.extend({initialize:function(){this.filterImages()},filterImages:function(){var a=this,b=[];async.forEach(this.data,function(a,c){var d=new Image,e=!1;d.onload=function(){e||(e=!0,b.push(a),c())},d.onerror=function(){e||(e=!0,c())},d.src=a.url+"/w/200",setTimeout(function(){e||(e=!0,c())},3e3)},function(){a.done(b)})}})}();