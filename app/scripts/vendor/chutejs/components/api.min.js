!function(a,b){"function"==typeof define&&define.amd?define(["underscore","backbone"],function(c,d){return b(c||a._,d||a.Backbone)}):b(_,Backbone)}(this,function(a,b){function c(b,c){var d=null;try{d=c.url}catch(e){}if(!d)try{d=a.isFunction(b.url)?b.url():b.url}catch(e){}return d}function d(a,b){return":"===a||":"===b?!1:a===b?!1:!0}var e={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};return b.vanillaSync=b.sync,b.sync=function(f,g,h){var i=!1,j=document.createElement("a");j.href=document.URL;var k=document.createElement("a");if(k.href=c(g,h),""!==k.host&&j.host!==k.host&&(i=!0),i&&!b.$.support.cors){var l=e[f];if(a.defaults(h||(h={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON}),!h.emulateHTTP&&("update"===f||"patch"===f||"delete"===f))throw new Error("Backbone.CrossDomain cannot use PUT, PATCH, DELETE with XDomainRequest (IE) and emulateHTTP=false");var m={type:l,dataType:"json"};if(h.url||(m.url=a.result(g,"url")||urlError()),d(j.protocol,k.protocol)&&(m.url=m.url.replace(new RegExp(k.protocol),j.protocol)),null!=h.data||!g||"create"!==f&&"update"!==f&&"patch"!==f||(m.data=JSON.stringify(h.attrs||g.toJSON(h))),h.emulateJSON&&(m.data=m.data?{model:m.data}:{}),h.emulateHTTP&&("PUT"===l||"DELETE"===l||"PATCH"===l)){m.type="POST",h.emulateJSON&&(m.data._method=l);var n=h.beforeSend;h.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",l),n?n.apply(this,arguments):void 0}}"GET"===m.type||h.emulateJSON||(m.processData=!1),"POST"===m.type&&(m.data=b.$.param(b.$.parseJSON(m.data)));var o=h.xhr=new XDomainRequest,p=h.success,q=h.error;if(b.$.fn.jquery){var r=b.$.Deferred(),s=b.$.Callbacks("once memory");r.promise(o).complete=s.add,o.onload=function(){var a={};o.responseText&&(a=b.$.parseJSON(o.responseText)),a?(r.resolveWith(this,[p,"success",o]),p(a)):(r.resolveWith(this,[p,"success",o]),p(a))},o.onerror=function(){q&&(q(g,o,h),r.resolveWith(this,[o,"error",q])),g.trigger("error",g,o,h)},o.done(o.onload),o.fail(o.onerror)}else o.onload=function(){var a={};o.responseText&&(a=b.$.parseJSON(o.responseText)),a&&p(a)},o.onerror=function(a){q&&q(g,a,h),g.trigger("error",g,a,h)};return o.open(m.type,m.url),o.onprogress=function(){},o.ontimeout=function(){},setTimeout(function(){o.send(m.data)},0),g.trigger("request",g,o,h),o}return b.vanillaSync.apply(this,arguments)},b}),function(a){Backbone.$=a,Chute.API={endpoint:"https://api.getchute.com/v2",options:{},setDefaults:function(a){this.options=_.extend({},this.options,a)}},Chute.Models={}}(window.jQueryChute||jQuery),function(a){Chute.Models.Album=Chute.Data.Model.extend({resourceName:"album",url:function(){},albums:function(b){var c=_.clone(this.options);delete c.album,Backbone.ajax({url:Chute.API.endpoint+"/albums/"+this.options.album+"/albums?"+a.param(_.extend({},Chute.API.options,c)),dataType:"json",success:function(a){if(b.success){var c=[];_(a.data).forEach(function(a){a=new Chute.Models.Album(a),c.push(a)}),b.success(c)}},error:b.error})},assets:function(a){var b=new Chute.API.Assets({album:this.get("shortcut")||this.get("album"),error:a.error,success:function(){a.success&&a.success(b.models)}})},inbox:function(b){var c=_.clone(this.options);delete c.album,Backbone.ajax({url:Chute.API.endpoint+"/albums/"+this.options.album+"/inbox?"+a.param(_.extend({},Chute.API.options,c)),dataType:"json",success:function(a){if(b.success){var c=[];_(a.data).forEach(function(a){a=new Chute.Models.Asset(a),c.push(a)}),b.success(c)}},error:b.error})},fetch:function(b){var c=this;Backbone.ajax({url:Chute.API.endpoint+"/albums/"+this.options.album+"?"+a.param(_.extend({},Chute.API.options,this.options)),dataType:"json",success:function(a){c.set(a.data),b.success&&b.success(c)},error:b.error})}}),Chute.API.Albums=Chute.Data.Collection.extend({model:Chute.Models.Album,resourceName:"albums",options:{},setDefaults:function(){this.options.page||(this.options.page=1),this.options.per_page||(this.options.per_page=30)},url:function(){return this.setDefaults(),Chute.API.endpoint+"/albums?"+a.param(_.extend({},Chute.API.options,this.options))}})}(window.jQueryChute||jQuery),function(a){Chute.Models.Asset=Chute.Data.Model.extend({resourceName:"asset",url:function(){return Chute.API.endpoint+"/albums/"+(this.get("album")||this.options.album)+"/assets/"+(this.get("shortcut")||this.get("asset")||this.options.asset)+"?"+a.param(Chute.API.options)},heart:function(b){b||(b={});var c=(this.get("album")||this.options.album)+"-"+this.get("shortcut")+"-heart",d=window.localStorage[c];if(d)return b.error&&b.error(),!1;var e=this;Backbone.ajax({url:Chute.API.endpoint+"/albums/"+(this.get("album")||this.options.album)+"/assets/"+this.get("shortcut")+"/hearts"+"?"+a.param(Chute.API.options),contentType:"application/json",type:"POST",data:"",success:function(a){window.localStorage[c]=a.data.identifier,e.set("hearts",parseInt(e.get("hearts"))+1),b.success&&b.success()},error:b.error})},unheart:function(b){b||(b={});var c=(this.get("album")||this.options.album)+"-"+this.get("shortcut")+"-heart",d=window.localStorage[c];if(!d)return b.error&&b.error(),!1;var e=this;Backbone.ajax({url:Chute.API.endpoint+"/hearts/"+d+"?"+a.param(Chute.API.options),contentType:"application/json",type:"DELETE",data:"",success:function(){delete window.localStorage[c],e.set("hearts",parseInt(e.get("hearts"))-1),b.success&&b.success()},error:b.error})},hearted:function(){return!!window.localStorage[(this.get("album")||this.options.album)+"-"+this.get("shortcut")+"-heart"]}}),Chute.API.Assets=Chute.Data.Collection.extend({model:Chute.Models.Asset,resourceName:"assets",options:{},setDefaults:function(){this.options.page||(this.options.page=1),this.options.per_page||(this.options.per_page=30)},url:function(){return this.setDefaults(),Chute.API.endpoint+"/albums/"+this.options.album+"/assets?"+a.param(_.extend({},Chute.API.options,_.omit(this.options,"album")))},parse:function(a){var b=[],c=this;return _(a.data).forEach(function(a){a.album=c.options.album,b.push(a)}),b},rawData:function(){var a=[],b=this;return _(this.models).forEach(function(c){c=c.attributes,c.album=b.options.album,c.asset=c.shortcut,a.push(c)}),a}})}(window.jQueryChute||jQuery),function(a){Chute.Models.Comment=Chute.Data.Model.extend({resourceName:"comment",url:function(){},sync:function(b,c,d){switch(b){case"create":Backbone.ajax({url:Chute.API.endpoint+"/albums/"+(c.get("album")||c.collection.album)+"/assets/"+(c.get("asset")||c.collection.asset)+"/comments?"+a.param(Chute.API.options),type:"POST",data:JSON.stringify(c.attributes),contentType:"application/json",success:function(){d.success&&d.success(c.toJSON(),200,null)},error:d.error})}},validate:function(a){var b=/^([\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*[\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+@((((([a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(\:\d{1,5})?)$/i;return a.email?b.test(a.email)?a.name?a.comment_text?void 0:"Comment is empty":"Name is empty":"Email is not valid":"Email is empty"}}),Chute.API.Comments=Chute.Data.Collection.extend({model:Chute.Models.Comment,resourceName:"comments",options:{},setDefaults:function(){this.options.page||(this.options.page=1),this.options.per_page||(this.options.per_page=30)},url:function(){return this.setDefaults(),Chute.API.endpoint+"/albums/"+this.options.album+"/assets/"+this.options.asset+"/comments?"+a.param(_.extend({},Chute.API.options,this.options))},add:function(){try{Backbone.Collection.prototype.add.apply(this,arguments)}catch(a){for(var b=arguments.length,c=0;b>c;c++){var d=arguments[c],e=new Chute.Models.Comment(d),f=e.validate(d);if(f)return this.trigger("error",f,d)}}},create:function(a){if(!Backbone.Collection.prototype.create.call(this,a)){var b=new Chute.Models.Comment(a);this.trigger("error",b.validate(a),a)}}})}(window.jQueryChute||jQuery);